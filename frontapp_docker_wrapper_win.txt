@echo off
REM Docker MCP Wrapper Script for Frontapp (Windows)
REM This script allows Claude Code to communicate with the MCP server running in Docker

setlocal enabledelayedexpansion

REM Get script directory
set "SCRIPT_DIR=%~dp0"
cd /d "%SCRIPT_DIR%"

REM Load environment variables from .env if exists
if exist ".env" (
    for /f "usebackq tokens=1,* delims==" %%a in (".env") do (
        if not "%%a"=="" if not "%%a:~0,1%"=="#" (
            set "%%a=%%b"
        )
    )
)

REM Check if API token is set
if "%FRONTAPP_API_TOKEN%"=="" (
    echo Error: FRONTAPP_API_TOKEN environment variable is not set >&2
    echo Please set it in .env file or environment variables >&2
    exit /b 1
)

REM Container name
set "CONTAINER_NAME=frontapp-mcp-server"

REM Check if container is running
docker ps --format "{{.Names}}" | findstr /x "%CONTAINER_NAME%" >nul 2>&1
if errorlevel 1 (
    echo Starting Frontapp MCP server container... >&2
    docker compose up -d
    timeout /t 2 /nobreak >nul
)

REM Execute the MCP server inside the container with stdio
docker exec -i -e FRONTAPP_API_TOKEN=%FRONTAPP_API_TOKEN% %CONTAINER_NAME% node dist/index.js
